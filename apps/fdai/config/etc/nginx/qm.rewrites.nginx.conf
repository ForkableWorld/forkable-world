location /api {
    #add_header Cache-Control "no-cache, must-revalidate, max-age=0";  # Let's manage cache on a per route basis in the API
    # proxy_set_header Host $host is needed to pass subdomain to app
    proxy_set_header Host $host;
    try_files $uri $uri/ /index.php?$args;
    if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Headers' 'X-Requested-With, Content-Type, Accept, Authorization, content-type, X-Mashape-Key, X-App-Name, X-Platform, X-App-Version, X-Client-Id, X-Framework, X-Timezone';
        add_header 'Access-Control-Allow-Methods' "GET, POST, OPTIONS, DELETE, PUT";
        add_header 'Access-Control-Max-Age' 1728000;
        return 200;
    }
}

location / {
	try_files $uri $uri/ /index.php$is_args$query_string;
}

# This is a route generated by the API and not an actual file path so we need this to avoid cache blocking
location = /api/v1/connect.js {
    try_files $uri $uri/ /index.php?$args;
}
# This is a route generated by the API and not an actual file path so we need this to avoid cache blocking
location = /api/v1/integration.js {
    try_files $uri $uri/ /index.php?$args;
}
# This is a route generated by the API and not an actual file path so we need this to avoid cache blocking
location = /api/v1/default.config.js {
    try_files $uri $uri/ /index.php?$args;
}
# This is a route generated by the API and not an actual file path so we need this to avoid cache blocking
location = /api/v3/connect.js {
    try_files $uri $uri/ /index.php?$args;
}
# This is a route generated by the API and not an actual file path so we need this to avoid cache blocking
location = /api/v3/integration.js {
    try_files $uri $uri/ /index.php?$args;
}
# This is a route generated by the API and not an actual file path so we need this to avoid cache blocking
location = /api/v3/default.config.js {
    try_files $uri $uri/ /index.php?$args;
}
